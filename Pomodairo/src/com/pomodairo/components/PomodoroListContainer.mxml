<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas
    xmlns:fx="http://ns.adobe.com/mxml/2009"
    xmlns:s="library://ns.adobe.com/flex/spark"
    xmlns:mx="library://ns.adobe.com/flex/mx"
    xmlns:lists="com.pomodairo.lists.*"
    initialize="init()">

    <fx:Script>
		<![CDATA[
        import com.pomodairo.EmbedImages;
        import com.pomodairo.core.TimeManager;
        import com.pomodairo.data.Pomodoro;
        import com.pomodairo.core.Storage;
        import com.pomodairo.settings.ConfigManager;

        import mx.collections.ArrayCollection;

        import spark.components.List;

        private var configManager:ConfigManager;
        private var db:Storage = Storage.instance;

//        [Bindable]
//        public var tabs:ArrayCollection = new ArrayCollection([
//            EmbedImages.ICON_LIST,
//            EmbedImages.ICON_STATS,
//            EmbedImages.ICON_STATS,
//            EmbedImages.ICON_HISTORY
//        ]);

        [Bindable]
        public var timeManager:TimeManager;

        private function init():void {
            configManager = ConfigManager.instance;
            configManager.initialize();
            db.initAndOpenDatabase();
            db.initViews();
            showSelectedPanel(0);
        }


        private function remove(pom:Pomodoro):void {
            db.remove(pom);
        }

        private function cleanup(event:MouseEvent):void {
            for each (var pom:Pomodoro in db.dataset) {
                if (pom.type == Pomodoro.TYPE_INTERRUPTION) {
                    remove(pom);
                } else if (pom.done) {
                    remove(pom);
                }
            }
            db.getAllItems();
        }

        public var selectedTab:int = 0;

        public function showSelectedPanel(index:int):void {
            selectedTab = index;
            taskList.includeInLayout = taskList.visible = false;
            pomodorosOfDayPanel.includeInLayout = pomodorosOfDayPanel.visible = false;
            pomodorosPerDayPanel.includeInLayout = pomodorosPerDayPanel.visible = false;
            realityFactorPanel.includeInLayout = realityFactorPanel.visible = false;

            switch (selectedTab) {
                case 0:
                    taskList.includeInLayout = taskList.visible = true;
                    break;
                case 1:
                    pomodorosOfDayPanel.includeInLayout = pomodorosOfDayPanel.visible = true;
                    break;
                case 2:
                    pomodorosPerDayPanel.includeInLayout = pomodorosPerDayPanel.visible = true;
                    break;
                case 3:
                    realityFactorPanel.includeInLayout = realityFactorPanel.visible = true;
                    break;
            }
        }
        ]]>
	</fx:Script>

    <lists:TaskList id="taskList" timeManager="{timeManager}" left="0" top="0" right="0" bottom="0"/>

    <lists:HistoryList id="pomodorosOfDayPanel" left="0" top="0" right="0" bottom="0"/>

    <lists:StatisticPerDayList id="pomodorosPerDayPanel" left="0" top="0" right="0" bottom="0"/>

    <lists:StatisticPerWeekList id="realityFactorPanel" left="0" top="0" right="0" bottom="0"/>

</mx:Canvas>
