<?xml version="1.0" encoding="utf-8"?>
<config:BaseConfigPanel
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:config="com.pomodairo.components.config.*"
	creationComplete="init()" >

<mx:Script>
        <![CDATA[
	import com.pomodairo.events.ConfigurationUpdatedEvent;
	import com.pomodairo.PomodoroEventDispatcher;
	import com.pomodairo.db.Storage;
	import com.pomodairo.settings.ConfigItemName;
	import com.pomodairo.settings.ConfigManager;


	private var pomodoroLength:Number = 25;
	private var shortBreakLength:Number = 5;
	private var longBreakLength:Number = 20;
	private var longBreakInterval:Number = 4;

	private function init():void {
		populate();
		applyGuiValues();
	}

	override public function populate():void {
		var conf:ConfigManager = ConfigManager.instance;

		if (conf.hasConfig(ConfigItemName.POMODORO_LENGTH)) {
			pomodoroLength = conf.getFloat(ConfigItemName.POMODORO_LENGTH);
		}

		if (conf.getConfig(ConfigItemName.SHORT_BREAK_LENGTH)) {
			shortBreakLength = conf.getFloat(ConfigItemName.SHORT_BREAK_LENGTH);
		}

		if (conf.getConfig(ConfigItemName.LONG_BREAK_LENGTH)) {
			longBreakLength = conf.getFloat(ConfigItemName.LONG_BREAK_LENGTH);
		}

		if (conf.getConfig(ConfigItemName.LONG_BREAK_INTERVAL)) {
			longBreakInterval = conf.getFloat(ConfigItemName.LONG_BREAK_INTERVAL);
		}
	}

	private function applyGuiValues():void {
		pomodoroSlider.value = pomodoroLength;
		shortBreakSlider.value = shortBreakLength;
		longBreakSlider.value = longBreakLength;
		longBreakSelect.value = longBreakInterval;
	}

	public function save():void {
		pomodoroLength = pomodoroSlider.value;
		shortBreakLength = shortBreakSlider.value;
		longBreakLength = longBreakSlider.value;
		longBreakInterval = longBreakSelect.value;

		Storage.instance.setConfigurationValue(ConfigItemName.POMODORO_LENGTH, "" + pomodoroLength);
		Storage.instance.setConfigurationValue(ConfigItemName.SHORT_BREAK_LENGTH, "" + shortBreakLength);
		Storage.instance.setConfigurationValue(ConfigItemName.LONG_BREAK_LENGTH, "" + longBreakLength);
		Storage.instance.setConfigurationValue(ConfigItemName.LONG_BREAK_INTERVAL, "" + longBreakInterval);
		exit();

		notifyConfiguration();
	}

	override public function notifyConfiguration():void {
		// Notify the world
		PomodoroEventDispatcher.instance.dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, ConfigItemName.POMODORO_LENGTH, "" + pomodoroLength));
		PomodoroEventDispatcher.instance.dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, ConfigItemName.SHORT_BREAK_LENGTH, "" + shortBreakLength));
		PomodoroEventDispatcher.instance.dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, ConfigItemName.LONG_BREAK_LENGTH, "" + longBreakLength));
		PomodoroEventDispatcher.instance.dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, ConfigItemName.LONG_BREAK_INTERVAL, "" + longBreakInterval));
	}
	]]>
    </mx:Script>
	<mx:Button x="221" y="90" label="Save" click="save()" width="63"/>
	<mx:Button x="221" y="121" label="Cancel" click="exit()"/>
	
	<mx:Label x="10" y="6" text="Pomodoro length" color="#A9A9A9"/>
	<mx:HSlider id="pomodoroSlider" x="10" y="15" snapInterval="1" minimum="1" maximum="60"/>
	
	<mx:Label x="10" y="48.3" text="Short break length" color="#A9A9A9"/>
	<mx:HSlider id="shortBreakSlider" x="10" y="57" snapInterval="1" minimum="1" maximum="30"/>
	
	<mx:Label x="10" y="91.3" text="Long break length" color="#A9A9A9"/>
	<mx:HSlider id="longBreakSlider" x="10" y="100" snapInterval="1" minimum="1" maximum="60"/>
	<mx:NumericStepper x="228" y="25" value="4" minimum="1" maximum="30" enabled="true" id="longBreakSelect" toolTip="Number of pomodoros until a long break"/>
	<mx:Label x="176" y="7" text="Long break interval"/>
	
</config:BaseConfigPanel>
